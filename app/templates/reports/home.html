{% extends "base.html" %}
{% block content %}

<!-- Header: tÃ­tulo + acciones (responsive) -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 mb-2">
  <div>
    <h3 class="mb-0">Reportes</h3>
    <div class="text-muted small">Resumen y exportaciÃ³n</div>
  </div>

  <!-- Botones export (wrap en mÃ³vil) -->
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-success btn-sm"
       href="{{ url_for('reports.export_csv') }}">
      ðŸ“Š Ventas (CSV)
    </a>

    <a class="btn btn-outline-success btn-sm"
       href="{{ url_for('reports.export_products_csv') }}">
      ðŸ“¦ Inventario (CSV)
    </a>
  </div>
</div>

<!-- Filtros (responsive) -->
<div class="card mb-3">
  <div class="card-body">
	<div class="card mb-3">
	  <div class="card-body">
		<div class="fw-semibold mb-2">Exportar ventas por rango</div>

		<form class="row g-2 align-items-end"
			  method="get"
			  action="{{ url_for('reports.export_sales_range') }}">

		  <div class="col-12 col-md-4">
			<label class="form-label mb-1">Desde</label>
			<input type="date" name="start" class="form-control form-control-sm" required>
		  </div>

		  <div class="col-12 col-md-4">
			<label class="form-label mb-1">Hasta</label>
			<input type="date" name="end" class="form-control form-control-sm" required>
		  </div>

		  <div class="col-12 col-md-4 d-grid">
			<button class="btn btn-dark btn-sm">â¬‡ Exportar rango (CSV)</button>
		  </div>
		</form>

		<div class="text-muted small mt-2">
		  Tip: Ãºtil para contabilidad, corte semanal o mensual.
		</div>
	  </div>
	</div>
    <form class="row g-2 align-items-end" method="get">	
      <div class="col-12 col-md-4">
        <label class="form-label mb-1">Periodo</label>
        <select class="form-select form-select-sm" name="days">
          <option value="1"  {{ 'selected' if days==1 else '' }}>Hoy</option>
          <option value="7"  {{ 'selected' if days==7 else '' }}>7 dÃ­as</option>
          <option value="30" {{ 'selected' if days==30 else '' }}>30 dÃ­as</option>
        </select>
      </div>
      <div class="col-12 col-md-4">
        <label class="form-label mb-1">Stock bajo (â‰¤ X)</label>
        <input class="form-control form-control-sm"
               name="low"
               value="{{ low }}"
               inputmode="numeric"
               title="Stock bajo <= X">
      </div>

      <div class="col-12 col-md-4 d-grid">
        <button class="btn btn-dark btn-sm">Ver</button>
      </div>
    </form>
  </div>
</div>

<!-- Cards resumen -->
<div class="row g-3">
  <div class="col-12 col-md-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <div class="text-muted">Total vendido</div>
        <div class="fs-3 text-success">${{ sales_total }}</div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <div class="text-muted">NÃºmero de ventas</div>
        <div class="fs-3">{{ sales_count }}</div>
      </div>
    </div>
  </div>
</div>

<hr class="my-4">

<h5 class="mb-2">Top productos (por cantidad)</h5>
<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table mb-0">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Ingreso</th>
        </tr>
      </thead>
      <tbody>
        {% for name, qty, income in top_by_qty %}
        <tr>
          <td>{{ name }}</td>
          <td>{{ qty }}</td>
          <td>${{ income }}</td>
        </tr>
        {% endfor %}
        {% if not top_by_qty %}
        <tr><td colspan="3" class="text-center text-muted py-3">Sin datos</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<hr class="my-4">

<h5 class="mb-2">Stock bajo (â‰¤ {{ low }})</h5>
<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table mb-0">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Stock</th>
        </tr>
      </thead>
      <tbody>
        {% for p in low_stock %}
        <tr>
          <td>{{ p.name }}</td>
          <td><strong>{{ p.stock }}</strong></td>
        </tr>
        {% endfor %}
        {% if not low_stock %}
        <tr><td colspan="2" class="text-center text-muted py-3">Todo bien âœ…</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}
